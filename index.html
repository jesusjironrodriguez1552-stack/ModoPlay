<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Liga Efootball 2025 - Debug</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <h1>Liga Efootball 2025 - Debug Mode</h1>
    
    <div id="standings-section">
        <h2>üèÜ Tabla de Posiciones</h2>
        <table>
            <thead>
                <tr>
                    <th>Pos</th>
                    <th>Equipo</th>
                    <th>PJ</th>
                    <th>PG</th>
                    <th>PE</th>
                    <th>PP</th>
                    <th>GF</th>
                    <th>GC</th>
                    <th>DG</th>
                    <th>Pts</th>
                </tr>
            </thead>
            <tbody id="standings-body"></tbody>
        </table>
    </div>

    <div id="fixtures-section">
        <h2>üìÖ Fixture Liga Efootball 2025</h2>
        <div id="fixture-navigation">
            <button id="prev-fecha" onclick="previousFecha()">‚¨ÖÔ∏è Fecha Anterior</button>
            <span id="current-fecha-display">Fecha 1</span>
            <button id="next-fecha" onclick="nextFecha()">Fecha Siguiente ‚û°Ô∏è</button>
        </div>
        <div id="fixtures-list"></div>
        <div id="fixtures-summary">
            <p>Total de fechas: <span id="total-fechas">0</span> | Fecha actual: <span id="current-fecha-number">1</span></p>
        </div>
    </div>

    <div id="fixture-helper-demo">
        <h2>Fixture Helper Demo:</h2>
        <button onclick="testFixtureHelper()">Test Fixture Helper Functions</button>
        <div id="helper-results"></div>
    </div>

    <script type="module">
        console.log('Liga Efootball 2025 starting...');
        
        // Variables globales
        let clubes = [];
        let customFixtures = [];
        let fixtureHelper = null;
        let currentFechaIndex = 0;
        
        // Funci√≥n para cargar los datos
        async function loadData() {
            try {
                console.log('Loading league data...');
                
                // Importar clubes
                const clubesModule = await import('./clubes.js');
                clubes = clubesModule.clubes || clubesModule.default || clubesModule;
                
                // Importar fixtures y helper
                const fixturesModule = await import('./fixtures.js');
                customFixtures = fixturesModule.customFixtures || fixturesModule.default;
                fixtureHelper = fixturesModule.fixtureHelper;
                
                if (clubes && Array.isArray(clubes) && clubes.length > 0) {
                    console.log(`‚úÖ Loaded ${clubes.length} teams`);
                } else {
                    console.error('‚ùå Failed to load teams data');
                    return;
                }
                
                if (customFixtures && Array.isArray(customFixtures) && customFixtures.length > 0) {
                    console.log(`‚úÖ Loaded ${customFixtures.length} fixtures`);
                    document.getElementById('total-fechas').textContent = customFixtures.length;
                } else {
                    console.error('‚ùå Failed to load fixtures data');
                    return;
                }
                
                // Mostrar los datos
                displayStandings();
                displayCurrentFixture();
                updateNavigationButtons();
                
            } catch (error) {
                console.error('Error loading data:', error);
                document.body.innerHTML += `<div style="color: red; text-align: center; margin: 20px;">
                    <h2>Error cargando datos</h2>
                    <p>${error.message}</p>
                    <p>Aseg√∫rate de tener los archivos clubes.js y fixtures.js en la misma carpeta.</p>
                </div>`;
            }
        }
        
        function displayStandings() {
            if (!clubes || clubes.length === 0) return;
            
            const tbody = document.getElementById('standings-body');
            tbody.innerHTML = '';
            
            // Crear estad√≠sticas b√°sicas para cada equipo
            const teamStats = clubes.map((club, index) => ({
                position: index + 1,
                name: club.name || club.nombre || club,
                played: 0,
                won: 0,
                drawn: 0,
                lost: 0,
                goalsFor: 0,
                goalsAgainst: 0,
                goalDifference: 0,
                points: 0
            }));
            
            // Si hay fixtures jugados, calcular estad√≠sticas reales
            if (customFixtures && customFixtures.length > 0) {
                customFixtures.forEach(fecha => {
                    fecha.partidos.forEach(partido => {
                        if (partido.resultado.jugado) {
                            const localTeam = teamStats.find(team => team.name === partido.local);
                            const visitanteTeam = teamStats.find(team => team.name === partido.visitante);
                            
                            if (localTeam && visitanteTeam) {
                                const golesLocal = partido.resultado.golesLocal;
                                const golesVisitante = partido.resultado.golesVisitante;
                                
                                // Actualizar estad√≠sticas del local
                                localTeam.played++;
                                localTeam.goalsFor += golesLocal;
                                localTeam.goalsAgainst += golesVisitante;
                                
                                // Actualizar estad√≠sticas del visitante
                                visitanteTeam.played++;
                                visitanteTeam.goalsFor += golesVisitante;
                                visitanteTeam.goalsAgainst += golesLocal;
                                
                                // Determinar resultado
                                if (golesLocal > golesVisitante) {
                                    localTeam.won++;
                                    localTeam.points += 3;
                                    visitanteTeam.lost++;
                                } else if (golesLocal < golesVisitante) {
                                    visitanteTeam.won++;
                                    visitanteTeam.points += 3;
                                    localTeam.lost++;
                                } else {
                                    localTeam.drawn++;
                                    visitanteTeam.drawn++;
                                    localTeam.points++;
                                    visitanteTeam.points++;
                                }
                            }
                        }
                    });
                });
                
                // Calcular diferencia de goles y ordenar por puntos
                teamStats.forEach(team => {
                    team.goalDifference = team.goalsFor - team.goalsAgainst;
                });
                
                teamStats.sort((a, b) => {
                    if (b.points !== a.points) return b.points - a.points;
                    if (b.goalDifference !== a.goalDifference) return b.goalDifference - a.goalDifference;
                    return b.goalsFor - a.goalsFor;
                });
                
                // Actualizar posiciones
                teamStats.forEach((team, index) => {
                    team.position = index + 1;
                });
            }
            
            // Mostrar en tabla
            teamStats.forEach(team => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${team.position}</strong></td>
                    <td><strong>${team.name}</strong></td>
                    <td>${team.played}</td>
                    <td>${team.won}</td>
                    <td>${team.drawn}</td>
                    <td>${team.lost}</td>
                    <td>${team.goalsFor}</td>
                    <td>${team.goalsAgainst}</td>
                    <td ${team.goalDifference > 0 ? 'style="color: green;"' : team.goalDifference < 0 ? 'style="color: red;"' : ''}>${team.goalDifference > 0 ? '+' : ''}${team.goalDifference}</td>
                    <td><strong>${team.points}</strong></td>
                `;
                tbody.appendChild(row);
            });
        }
        
        function displayCurrentFixture() {
            if (!customFixtures || customFixtures.length === 0) {
                document.getElementById('fixtures-list').innerHTML = '<p>No hay fixtures disponibles</p>';
                return;
            }
            
            const currentFixture = customFixtures[currentFechaIndex];
            const fixturesList = document.getElementById('fixtures-list');
            
            document.getElementById('current-fecha-display').textContent = `Fecha ${currentFixture.fecha}`;
            document.getElementById('current-fecha-number').textContent = currentFechaIndex + 1;
            
            fixturesList.innerHTML = '';
            
            const fechaDiv = document.createElement('div');
            fechaDiv.className = 'fecha-container';
            
            let partidosJugados = 0;
            let partidosPendientes = 0;
            
            currentFixture.partidos.forEach(partido => {
                const matchDiv = document.createElement('div');
                matchDiv.className = `match-item ${partido.resultado.jugado ? 'played' : 'pending'}`;
                
                if (partido.resultado.jugado) {
                    partidosJugados++;
                    matchDiv.innerHTML = `
                        <div class="match-teams">
                            <span class="team local">${partido.local}</span>
                            <span class="result">${partido.resultado.golesLocal} - ${partido.resultado.golesVisitante}</span>
                            <span class="team visitante">${partido.visitante}</span>
                        </div>
                        <div class="match-status played">‚úÖ Finalizado</div>
                    `;
                } else {
                    partidosPendientes++;
                    matchDiv.innerHTML = `
                        <div class="match-teams">
                            <span class="team local">${partido.local}</span>
                            <span class="vs">VS</span>
                            <span class="team visitante">${partido.visitante}</span>
                        </div>
                        <div class="match-status pending">‚è≥ Pendiente</div>
                    `;
                }
                
                fechaDiv.appendChild(matchDiv);
            });
            
            // Agregar resumen de la fecha
            const summaryDiv = document.createElement('div');
            summaryDiv.className = 'fecha-summary';
            summaryDiv.innerHTML = `
                <p><strong>Resumen Fecha ${currentFixture.fecha}:</strong></p>
                <p>Partidos jugados: ${partidosJugados} | Partidos pendientes: ${partidosPendientes}</p>
            `;
            
            fixturesList.appendChild(summaryDiv);
            fixturesList.appendChild(fechaDiv);
        }
        
        function updateNavigationButtons() {
            const prevBtn = document.getElementById('prev-fecha');
            const nextBtn = document.getElementById('next-fecha');
            
            prevBtn.disabled = currentFechaIndex === 0;
            nextBtn.disabled = currentFechaIndex === customFixtures.length - 1;
        }
        
        // Funciones de navegaci√≥n
        window.previousFecha = function() {
            if (currentFechaIndex > 0) {
                currentFechaIndex--;
                displayCurrentFixture();
                updateNavigationButtons();
            }
        };
        
        window.nextFecha = function() {
            if (currentFechaIndex < customFixtures.length - 1) {
                currentFechaIndex++;
                displayCurrentFixture();
                updateNavigationButtons();
            }
        };
        
        // Funci√≥n para probar el fixtureHelper (mantener para debug si es necesario)
        window.testFixtureHelper = function() {
            if (!fixtureHelper) {
                document.getElementById('helper-results').innerHTML = '<p style="color: red;">FixtureHelper not loaded</p>';
                return;
            }
            
            const results = document.getElementById('helper-results');
            results.innerHTML = '<h3>Testing FixtureHelper Functions:</h3>';
            
            try {
                results.innerHTML += '<p><strong>Available functions:</strong></p>';
                results.innerHTML += '<ul>';
                for (let key in fixtureHelper) {
                    if (typeof fixtureHelper[key] === 'function') {
                        results.innerHTML += `<li>${key}()</li>`;
                    }
                }
                results.innerHTML += '</ul>';
            } catch (error) {
                results.innerHTML += `<p style="color: red;">Error: ${error.message}</p>`;
            }
        };
        
        // Cargar datos al iniciar
        document.addEventListener('DOMContentLoaded', loadData);
        window.addEventListener('load', loadData);
    </script>
</body>
</html>
