<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Liga Efootball 2025 - Debug</title>
</head>
<body>
    <h1>Liga Efootball 2025 - Debug Mode</h1>
    
    <div id="debug-info">
        <h2>Debug Information:</h2>
        <p>Clubes loaded: <span id="clubes-status">Loading...</span></p>
        <p>Fixtures loaded: <span id="fixtures-status">Loading...</span></p>
        <p>Teams count: <span id="teams-count">0</span></p>
        <p>Fixtures count: <span id="fixtures-count">0</span></p>
    </div>

    <div id="teams-section">
        <h2>Teams List:</h2>
        <ul id="teams-list"></ul>
    </div>

    <div id="fixtures-section">
        <h2>First 2 Fixtures:</h2>
        <div id="fixtures-list"></div>
    </div>

    <div id="standings-section">
        <h2>Standings:</h2>
        <table border="1">
            <thead>
                <tr>
                    <th>Team</th>
                    <th>Played</th>
                    <th>Points</th>
                </tr>
            </thead>
            <tbody id="standings-body"></tbody>
        </table>
    </div>

    <div id="fixture-helper-demo">
        <h2>Fixture Helper Demo:</h2>
        <button onclick="testFixtureHelper()">Test Fixture Helper Functions</button>
        <div id="helper-results"></div>
    </div>

    <script type="module">
        console.log('Script starting...');
        
        // Variables globales para almacenar los datos importados
        let clubes = [];
        let customFixtures = [];
        let fixtureHelper = null;
        
        // Función para cargar los datos
        async function loadData() {
            try {
                // Importar clubes
                const clubesModule = await import('./clubes.js');
                clubes = clubesModule.clubes || clubesModule.default;
                console.log('Clubes loaded:', clubes);
                document.getElementById('clubes-status').textContent = 'Loaded ✓';
                document.getElementById('teams-count').textContent = clubes ? clubes.length : 0;
                
                // Importar fixtures y helper
                const fixturesModule = await import('./fixtures.js');
                customFixtures = fixturesModule.customFixtures;
                fixtureHelper = fixturesModule.fixtureHelper;
                console.log('CustomFixtures loaded:', customFixtures);
                console.log('FixtureHelper loaded:', fixtureHelper);
                document.getElementById('fixtures-status').textContent = 'Loaded ✓';
                document.getElementById('fixtures-count').textContent = customFixtures ? customFixtures.length : 0;
                
                // Mostrar los datos cargados
                displayTeams();
                displayFixtures();
                displayStandings();
                
            } catch (error) {
                console.error('Error loading modules:', error);
                document.getElementById('clubes-status').textContent = 'Load Error ✗';
                document.getElementById('fixtures-status').textContent = 'Load Error ✗';
                document.getElementById('debug-info').innerHTML += `<p style="color: red;">Error: ${error.message}</p>`;
            }
        }
        
        function displayTeams() {
            if (!clubes || clubes.length === 0) return;
            
            const teamsList = document.getElementById('teams-list');
            teamsList.innerHTML = '';
            
            clubes.forEach(club => {
                const li = document.createElement('li');
                li.textContent = `${club.name} - ${club.club || 'No club info'}`;
                teamsList.appendChild(li);
            });
        }
        
        function displayFixtures() {
            if (!customFixtures || customFixtures.length === 0) return;
            
            const fixturesList = document.getElementById('fixtures-list');
            fixturesList.innerHTML = '';
            
            // Show only first 2 fixtures to avoid clutter
            customFixtures.slice(0, 2).forEach(jornada => {
                const div = document.createElement('div');
                div.innerHTML = `<h3>Fecha ${jornada.fecha}</h3>`;
                
                jornada.partidos.forEach(partido => {
                    const matchDiv = document.createElement('div');
                    matchDiv.textContent = `${partido.local} vs ${partido.visitante} - Jugado: ${partido.resultado.jugado}`;
                    div.appendChild(matchDiv);
                });
                
                fixturesList.appendChild(div);
            });
        }
        
        function displayStandings() {
            if (!clubes || clubes.length === 0) return;
            
            const tbody = document.getElementById('standings-body');
            tbody.innerHTML = '';
            
            clubes.forEach(club => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${club.name}</td>
                    <td>0</td>
                    <td>0</td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // Función para probar el fixtureHelper
        window.testFixtureHelper = function() {
            if (!fixtureHelper) {
                document.getElementById('helper-results').innerHTML = '<p style="color: red;">FixtureHelper not loaded</p>';
                return;
            }
            
            const results = document.getElementById('helper-results');
            results.innerHTML = '<h3>Testing FixtureHelper Functions:</h3>';
            
            try {
                // Mostrar qué funciones están disponibles en fixtureHelper
                results.innerHTML += '<p><strong>Available functions in fixtureHelper:</strong></p>';
                results.innerHTML += '<ul>';
                for (let key in fixtureHelper) {
                    if (typeof fixtureHelper[key] === 'function') {
                        results.innerHTML += `<li>${key}()</li>`;
                    }
                }
                results.innerHTML += '</ul>';
                
                // Probar obtener estadísticas si hay fixtures disponibles
                if (customFixtures && customFixtures.length > 0) {
                    const primeraFecha = customFixtures[0].fecha;
                    results.innerHTML += `<p><strong>Testing with fecha ${primeraFecha}:</strong></p>`;
                    
                    // Obtener el primer partido de la primera fecha
                    const primerPartido = customFixtures[0].partidos[0];
                    if (primerPartido) {
                        results.innerHTML += `<p>Trying to get stats for: ${primerPartido.local} vs ${primerPartido.visitante}</p>`;
                        
                        const estadisticas = fixtureHelper.obtenerEstadisticasPartido(primeraFecha, primerPartido.local);
                        results.innerHTML += `<p><strong>Estadísticas result:</strong> ${estadisticas ? JSON.stringify(estadisticas, null, 2) : 'null/undefined'}</p>`;
                    }
                } else {
                    results.innerHTML += '<p>No fixtures available for testing</p>';
                }
            } catch (error) {
                results.innerHTML += `<p style="color: red;">Error testing fixtureHelper: ${error.message}</p>`;
                console.error('Full error:', error);
            }
        };
        
        // Cargar los datos cuando el DOM esté listo
        document.addEventListener('DOMContentLoaded', loadData);
        
        // También intentar cargar en el evento load de la ventana
        window.addEventListener('load', loadData);
    </script>
</body>
</html>
